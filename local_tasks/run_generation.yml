---

- name: Load our vars file
  include_vars:
    file: "{{ vars_file }}"
    name: env_vars

- name: Set our vars in global
  set_fact:
    "{{ item.key }}": "{{ item.value }}"
  with_dict: "{{ env_vars }}"

- name: Load our common vars
  include_vars:
    file: "{{ playbook_dir }}/common/common.credentials.yml"
    name: common_vars

- name: Combine our vars
  set_fact:
    tmp_vars: "{{ (common_vars|merge_config_dictionaries(vars)) }}"

- name: Export our products
  set_fact:
    products: "{{ tmp_vars.products }}"

- name: Export our account
  set_fact:
    account: "{{ tmp_vars.account }}"

- name: Output what we are running
  debug:
    msg: "Running generation for {{ vars_file|basename|replace('.yaml', '')|replace('.yml', '') }}"

- name: Generate our secrets
  include_role:
    name: "{{ playbook_dir }}/roles/roles/credentials"
